import{_ as E}from"./index-D9KZYldU.js";import{_ as B}from"./index-DVgj2YNw.js";import{_ as N,j as r,o as d,h as P,w as R,k as V,a as i,u,c as y,O as I,p as D,d as L}from"./index-DLqeNj1X.js";import"./index-v8mxky7W.js";import"./index-Dqgskfkp.js";const x=l=>(D("data-v-309681e4"),l=l(),L(),l),O={class:"box"},U={class:"box-item"},A=x(()=>i("p",null,"未压缩",-1)),G=["src"],H={class:"box-item"},M=x(()=>i("p",null,"压缩后",-1)),T=["src"],W={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(l,{emit:w}){const m=l,C=w,_=r(null);let a=r({});const b={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},j=e=>{if(a.value=e,!a.value||!b[a.value.type])return h(),alert("请选择正确格式的图片");if(a.value.type==="image/png")return h(),alert("png格式的图片暂不适用");k(a.value)},s=r(""),n=r(""),p=new FileReader,k=e=>{e instanceof File&&(p.onload=async()=>{s.value=p.result,await F({imgSrc:s.value,type:e.type}),console.log("originImgSrc.value",s.value.length,"compressedImgSrc.value",n.value.length)},p.readAsDataURL(e))},F=({imgSrc:e,type:c})=>{const t=document.createElement("canvas"),o=document.createElement("img"),q=t.getContext("2d");return o.src=e,new Promise(S=>{o.onload=()=>{const v=o.width,f=o.height;t.width=v,t.height=f,q.drawImage(o,0,0,v,f),g(t,e,c),S(!0)}})},g=(e,c,t)=>{n.value=e.toDataURL(t,m.quality/100),n.value.length>=c.length&&m.quality>=10&&(C("update:quality",m.quality-10),g(e,c,t))},h=()=>{_.value.value="",a.value=null,n.value="",s.value=""};return(e,c)=>{const t=B,o=E;return d(),P(o,{title:"图片压缩",subtitle:"请选择jpg格式图片",class:"ifrname-box",column:"",needCode:!1},{default:R(()=>[V(t,{id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:_,onChange:j},null,512),i("div",O,[i("div",U,[A,u(s)?(d(),y("img",{key:0,src:u(s),title:"未压缩",alt:"未压缩"},null,8,G)):I("",!0)]),i("div",H,[M,u(n)?(d(),y("img",{key:0,src:u(n),title:"压缩后",alt:"压缩后"},null,8,T)):I("",!0)])])]),_:1})}}},Q=N(W,[["__scopeId","data-v-309681e4"]]);export{Q as default};
