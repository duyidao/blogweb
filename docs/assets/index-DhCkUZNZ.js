import{_ as B}from"./index-JPMgQMGR.js";import E from"./index-DpVeJOIG.js";import{_ as N,r,o as p,A as P,w as R,f as V,a as i,u,c as y,M as I,p as A,d as D}from"./index-ifJWoGPW.js";import"./index-CYLCs7wp.js";import"./index-B2g2asbn.js";const x=l=>(A("data-v-13981a34"),l=l(),D(),l),L={class:"box"},M={class:"box-item"},U=x(()=>i("p",null,"未压缩",-1)),G=["src"],H={class:"box-item"},O=x(()=>i("p",null,"压缩后",-1)),T=["src"],W={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(l,{emit:w}){const m=l,C=w,g=r(null);let a=r({});const b={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},F=e=>{if(a.value=e,!a.value||!b[a.value.type])return h(),alert("请选择正确格式的图片");if(a.value.type==="image/png")return h(),alert("png格式的图片暂不适用");j(a.value)},o=r(""),s=r(""),d=new FileReader,j=e=>{e instanceof File&&(d.onload=async()=>{o.value=d.result,await k({imgSrc:o.value,type:e.type}),console.log("originImgSrc.value",o.value.length,"compressedImgSrc.value",s.value.length)},d.readAsDataURL(e))},k=({imgSrc:e,type:n})=>{const t=document.createElement("canvas"),c=document.createElement("img"),q=t.getContext("2d");return c.src=e,new Promise(S=>{c.onload=()=>{const v=c.width,f=c.height;t.width=v,t.height=f,q.drawImage(c,0,0,v,f),_(t,e,n),S(!0)}})},_=(e,n,t)=>{s.value=e.toDataURL(t,m.quality/100),s.value.length>=n.length&&m.quality>=10&&(C("update:quality",m.quality-10),_(e,n,t))},h=()=>{g.value.value="",a.value=null,s.value="",o.value=""};return(e,n)=>{const t=B;return p(),P(E,{title:"图片压缩",subtitle:"请选择jpg格式图片",class:"ifrname-box",column:"",needCode:!1},{default:R(()=>[V(t,{id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:g,onChange:F},null,512),i("div",L,[i("div",M,[U,u(o)?(p(),y("img",{key:0,src:u(o),title:"未压缩",alt:"未压缩"},null,8,G)):I("",!0)]),i("div",H,[O,u(s)?(p(),y("img",{key:0,src:u(s),title:"压缩后",alt:"压缩后"},null,8,T)):I("",!0)])])]),_:1})}}},X=N(W,[["__scopeId","data-v-13981a34"]]);export{X as default};
