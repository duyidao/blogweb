import{_ as E}from"./index-CjqDs1e6.js";import{_ as B}from"./index-5J9dLsPs.js";import{_ as N,r,o as p,k as P,w as R,e as V,a as i,u,c as y,O as I,p as D,d as L}from"./index-Debkh1Ib.js";import"./index-BBm7cKaK.js";const x=l=>(D("data-v-158ddaa8"),l=l(),L(),l),O={class:"box"},U={class:"box-item"},A=x(()=>i("p",null,"未压缩",-1)),G=["src"],H={class:"box-item"},M=x(()=>i("p",null,"压缩后",-1)),T=["src"],W={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(l,{emit:w}){const m=l,C=w,_=r(null);let o=r({});const b={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},k=e=>{if(o.value=e,!o.value||!b[o.value.type])return h(),alert("请选择正确格式的图片");if(o.value.type==="image/png")return h(),alert("png格式的图片暂不适用");F(o.value)},s=r(""),n=r(""),d=new FileReader,F=e=>{e instanceof File&&(d.onload=async()=>{s.value=d.result,await j({imgSrc:s.value,type:e.type}),console.log("originImgSrc.value",s.value.length,"compressedImgSrc.value",n.value.length)},d.readAsDataURL(e))},j=({imgSrc:e,type:c})=>{const t=document.createElement("canvas"),a=document.createElement("img"),q=t.getContext("2d");return a.src=e,new Promise(S=>{a.onload=()=>{const v=a.width,f=a.height;t.width=v,t.height=f,q.drawImage(a,0,0,v,f),g(t,e,c),S(!0)}})},g=(e,c,t)=>{n.value=e.toDataURL(t,m.quality/100),n.value.length>=c.length&&m.quality>=10&&(C("update:quality",m.quality-10),g(e,c,t))},h=()=>{_.value.value="",o.value=null,n.value="",s.value=""};return(e,c)=>{const t=B,a=E;return p(),P(a,{title:"图片压缩",subtitle:"请选择jpg格式图片",class:"iframe-box",column:"",needCode:!1},{default:R(()=>[V(t,{id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:_,onChange:k},null,512),i("div",O,[i("div",U,[A,u(s)?(p(),y("img",{key:0,src:u(s),title:"未压缩",alt:"未压缩"},null,8,G)):I("",!0)]),i("div",H,[M,u(n)?(p(),y("img",{key:0,src:u(n),title:"压缩后",alt:"压缩后"},null,8,T)):I("",!0)])])]),_:1})}}},K=N(W,[["__scopeId","data-v-158ddaa8"]]);export{K as default};
