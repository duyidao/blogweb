import{_ as B}from"./index-BfQoC-rC.js";import N from"./index-BpbQJMOa.js";import{_ as P,r,o as p,c as g,e as I,w as R,b as i,u,M as x,p as V,d as D}from"./index-BJQdFUCM.js";import"./index-B4HB8O45.js";const w=n=>(V("data-v-a363a020"),n=n(),D(),n),L={class:"ifrname-box"},M={class:"box"},U={class:"box-item"},A=w(()=>i("p",null,"未压缩",-1)),G=["src"],H={class:"box-item"},O=w(()=>i("p",null,"压缩后",-1)),T=["src"],W={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(n,{emit:b}){const m=n,C=b,_=r(null);let a=r({});const F={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},j=e=>{if(a.value=e,!a.value||!F[a.value.type])return v(),alert("请选择正确格式的图片");if(a.value.type==="image/png")return v(),alert("png格式的图片暂不适用");q(a.value)},o=r(""),s=r(""),d=new FileReader,q=e=>{e instanceof File&&(d.onload=async()=>{o.value=d.result,await S({imgSrc:o.value,type:e.type}),console.log("originImgSrc.value",o.value.length,"compressedImgSrc.value",s.value.length)},d.readAsDataURL(e))},S=({imgSrc:e,type:l})=>{const t=document.createElement("canvas"),c=document.createElement("img"),k=t.getContext("2d");return c.src=e,new Promise(E=>{c.onload=()=>{const f=c.width,y=c.height;t.width=f,t.height=y,k.drawImage(c,0,0,f,y),h(t,e,l),E(!0)}})},h=(e,l,t)=>{s.value=e.toDataURL(t,m.quality/100),s.value.length>=l.length&&m.quality>=10&&(C("update:quality",m.quality-10),h(e,l,t))},v=()=>{_.value.value="",a.value=null,s.value="",o.value=""};return(e,l)=>{const t=B;return p(),g("div",L,[I(N,{title:"图片压缩",subtitle:"请选择jpg格式图片",column:"",needCode:!1},{default:R(()=>[I(t,{id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:_,onChange:j},null,512),i("div",M,[i("div",U,[A,u(o)?(p(),g("img",{key:0,src:u(o),title:"未压缩",alt:"未压缩"},null,8,G)):x("",!0)]),i("div",H,[O,u(s)?(p(),g("img",{key:0,src:u(s),title:"压缩后",alt:"压缩后"},null,8,T)):x("",!0)])])]),_:1})])}}},Q=P(W,[["__scopeId","data-v-a363a020"]]);export{Q as default};
