import{_ as k,r as i,o as u,c as m,d as h,y as f}from"./index-BK9px7Wf.js";const E={class:"ifrname-box"},B={class:"box"},N=["src"],P=["src"],R={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(y,{emit:I}){const c=y,x=I,g=i(null);let a=i({});const w={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},F=e=>{if(a.value=e.target.files[0],!a.value||!w[a.value.type])return p(),alert("请选择正确格式的图片");if(a.value.type==="image/png")return p(),alert("png格式的图片暂不适用");q(a.value)},l=i(""),n=i(""),r=new FileReader,q=e=>{e instanceof File&&(r.onload=async()=>{l.value=r.result,await C({imgSrc:l.value,type:e.type}),console.log("originImgSrc.value",l.value.length,"compressedImgSrc.value",n.value.length)},r.readAsDataURL(e))},C=({imgSrc:e,type:s})=>{const t=document.createElement("canvas"),o=document.createElement("img"),b=t.getContext("2d");return o.src=e,new Promise(j=>{o.onload=()=>{const v=o.width,_=o.height;t.width=v,t.height=_,b.drawImage(o,0,0,v,_),d(t,e,s),j(!0)}})},d=(e,s,t)=>{n.value=e.toDataURL(t,c.quality/100),n.value.length>=s.length&&c.quality>=10&&(x("update:quality",c.quality-10),d(e,s,t))},p=()=>{g.value.value="",a.value=null,n.value="",l.value=""};return(e,s)=>(u(),m("div",E,[h("input",{type:"file",name:"file",id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:g,onChange:F},null,544),h("div",B,[l.value?(u(),m("img",{key:0,src:l.value,alt:"未压缩"},null,8,N)):f("",!0),n.value?(u(),m("img",{key:1,src:n.value,alt:"压缩后"},null,8,P)):f("",!0)])]))}},D=k(R,[["__scopeId","data-v-329812fb"]]);export{D as default};
