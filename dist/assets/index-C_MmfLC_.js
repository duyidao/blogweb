import{_ as k,b as i,o as u,c as m,e as _,i as f}from"./index-DYkwee5G.js";const E={class:"box"},B=["src"],N=["src"],P={__name:"index",props:{quality:{type:Number,default:90}},emits:["update:quality"],setup(y,{emit:I}){const c=y,x=I,g=i(null);let a=i({});const w={"image/jpeg":"image/jpeg","image/jpg":"image/jpg"},F=e=>{if(a.value=e.target.files[0],!a.value||!w[a.value.type])return p(),alert("请选择正确格式的图片");if(a.value.type==="image/png")return p(),alert("png格式的图片暂不适用");b(a.value)},l=i(""),n=i(""),r=new FileReader,b=e=>{e instanceof File&&(r.onload=async()=>{l.value=r.result,await q({imgSrc:l.value,type:e.type}),console.log("originImgSrc.value",l.value.length,"compressedImgSrc.value",n.value.length)},r.readAsDataURL(e))},q=({imgSrc:e,type:s})=>{const t=document.createElement("canvas"),o=document.createElement("img"),C=t.getContext("2d");return o.src=e,new Promise(j=>{o.onload=()=>{const v=o.width,h=o.height;t.width=v,t.height=h,C.drawImage(o,0,0,v,h),d(t,e,s),j(!0)}})},d=(e,s,t)=>{n.value=e.toDataURL(t,c.quality/100),n.value.length>=s.length&&c.quality>=10&&(x("update:quality",c.quality-10),d(e,s,t))},p=()=>{g.value.value="",a.value=null,n.value="",l.value=""};return(e,s)=>(u(),m("div",null,[_("input",{type:"file",name:"file",id:"imgFile",placeholder:"请选择图片",ref_key:"imgFile",ref:g,onChange:F},null,544),_("div",E,[l.value?(u(),m("img",{key:0,src:l.value,alt:"未压缩"},null,8,B)):f("",!0),n.value?(u(),m("img",{key:1,src:n.value,alt:"压缩后"},null,8,N)):f("",!0)])]))}},S=k(P,[["__scopeId","data-v-431b8fb7"]]);export{S as default};
